<!doctype html>
<html lang="fr">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>S√©chilienne ‚Äî Histoire & Patrimoines</title>
<script src="https://cdn.tailwindcss.com"></script>
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script src="https://unpkg.com/marked@12.0.2/marked.min.js"></script>
<style>
  .no-scrollbar::-webkit-scrollbar{display:none}
  .no-scrollbar{-ms-overflow-style:none;scrollbar-width:none}
  #map{height:28rem}@media(min-width:768px){#map{height:34rem}}
</style>
</head>
<body class="min-h-screen bg-[radial-gradient(ellipse_at_top,_#f6f2ea,_#ece7df)] text-neutral-900">
<div id="root"></div>

<!-- React 18 UMD -->
<script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
<script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
<script src="https://unpkg.com/@babel/standalone@7/babel.min.js"></script>

<script type="text/babel">
/* ========= Donn√©es par d√©faut (√©cras√©es par data.json si pr√©sent) ========= */
const DEFAULT_DATA = {
  eras: [
    { id:"all", label:"Tout" },
    { id:"antiquite", label:"Antiquit√©" },
    { id:"moyenage", label:"Moyen √Çge" },
    { id:"modernes", label:"Temps modernes" },
    { id:"revolution", label:"R√©volution & Empire" },
    { id:"XXe", label:"XXe si√®cle" }
  ],
  /* √©v√©nements : section = chrono | guerres | economie | vie */
  events: [
    { id:"ant-1", slug:"voie-romaine", section:"chrono", year:"Ier‚ÄìIVe s.", era:"antiquite",
      title:"Voie romaine de la Romanche", summary:"Itin√©raire antique reliant Grenoble √† l‚ÄôOisans.",
      tags:["patrimoine","arch√©o"], group:"Antiquit√© ‚Äî itin√©raires", order:10, importance:3,
      body:"# Voie romaine\n\nTron√ßons probables en vall√©e (sources √† pr√©ciser)." },
    { id:"ma-1", slug:"guigues-alleman", section:"chrono", year:"v. 1195‚Äì1248", era:"moyenage",
      title:"Guigues I·µâ ≥ Alleman", summary:"Premier seigneur attest√© de S√©chilienne.",
      tags:["seigneurs"], group:"Moyen √Çge ‚Äî seigneuries", order:20, importance:3,
      body:"# Guigues I·µâ ≥ Alleman\n\nPoint de d√©part de la chronologie seigneuriale." },
    { id:"re-4", slug:"route-napoleon-1815", section:"chrono", year:"7 mars 1815", era:"revolution",
      title:"Route Napol√©on (Laffrey, proximit√©)", summary:"Cent-Jours √† proximit√© de S√©chilienne.",
      tags:["Napol√©on"], group:"R√©volution & Empire", order:90, importance:2,
      body:"# 7 mars 1815\n\nRencontre √† Laffrey ; impacts r√©gionaux." },

    /* guerres (XXe) */
    { id:"w-1", slug:"monument-aux-morts", section:"guerres", year:"1920s", era:"XXe",
      title:"Monument aux morts", summary:"M√©moire 14-18 / 39-45.",
      tags:["m√©moire"], group:"M√©moire communale", order:10, importance:2,
      body:"# Monument aux morts\n\nNoms, c√©r√©monies, archives municipales." },

    /* √©conomie & industrialisation */
    { id:"eco-1", slug:"premiers-moulins", section:"economie", year:"XVIIe‚ÄìXVIIIe s.", era:"modernes",
      title:"Moulins et artisanat", summary:"√âconomie rurale et artisanale.",
      tags:["√©conomie"], group:"√âconomie rurale", order:10, importance:1,
      body:"# Moulins et artisanat\n\nUsages hydrauliques, ateliers, toponymie." }
  ],

  /* sites (patrimoine) */
  pois: [
    { id:"poi-eglise", slug:"eglise", section:"patrimoine", name:"√âglise & noyau paroissial",
      lat:45.048, lng:5.839, kind:"patrimoine", note:"Ancrage m√©di√©val (√† pr√©ciser)", order:10,
      body:"# √âglise\n\nHistoire, remaniements, mobilier (sources‚Ä¶)." },
    { id:"poi-chateau", slug:"chateau", section:"patrimoine", name:"Site castral (ch√¢teau)",
      lat:45.053, lng:5.840, kind:"patrimoine", note:"Traces et iconographie √† r√©unir", order:20,
      body:"# Site castral\n\nRep√®res, seigneuries, destructions." },
    { id:"poi-voie", slug:"voie-romaine", section:"patrimoine", name:"Voie romaine (tron√ßon)",
      lat:45.055, lng:5.820, kind:"patrimoine", note:"Segment probable", order:30,
      body:"# Voie romaine ‚Äî rep√®re\n\nCoordonn√©es, photos sur le terrain." }
  ],

  /* familles & personnalit√©s */
  families: [
    { name:"Alleman", slug:"alleman", section:"personnalites", period:"XIIIe‚ÄìXIVe",
      note:"Lign√©e seigneuriale", order:10, body:"# Famille Alleman\n\nActes, hommages, possessions." },
    { name:"Simiane", slug:"simiane", section:"personnalites", period:"XVIe",
      note:"Alliances / transmissions", order:20, body:"# Famille de Simiane\n\nFiliations √† pr√©ciser." },
    { name:"du Mottet", slug:"du-mottet", section:"personnalites", period:"XVIIe‚ÄìXVIIIe",
      note:"Toponymie (Croix du Mottet)", order:30, body:"# Maison du Mottet\n\nRep√®res et r√¥les." }
  ],

  /* articles = textes th√©matiques (vie, economie, etc.) */
  articles: [
    { id:"vie-ecole", slug:"ecoles-hameaux", section:"vie",
      title:"√âcoles & hameaux", summary:"Organisation scolaire et vie des hameaux.",
      order:10, body:"# √âcoles & hameaux\n\nListes, photos, t√©moignages‚Ä¶" },
    { id:"eco-trav", slug:"travaux-industrie", section:"economie",
      title:"De la meule √† l'usine", summary:"Transition vers l‚Äôindustrialisation.",
      order:20, body:"# De la meule √† l‚Äôusine\n\nDates, sites, effets sociaux." }
  ],

  /* galerie */
  gallery: [
    { id:"img-1", src:"https://upload.wikimedia.org/wikipedia/commons/3/3f/Placeholder_view_vector.svg", caption:"Carte postale ‚Äî centre du bourg (exemple)", credit:"Coll. priv√©e", order:10 },
    { id:"img-2", src:"https://upload.wikimedia.org/wikipedia/commons/3/3f/Placeholder_view_vector.svg", caption:"Vue g√©n√©rale (exemple)", credit:"Archives", order:20 }
  ],

  /* ressources (bibliographie / liens) */
  resources: [
    { id:"bib-1", label:"Bulletins des Amis de l‚ÄôHistoire du Pays de Vizille (AHPV)", url:"#", note:"S√©lection d‚Äôarticles" },
    { id:"bib-2", label:"Archives d√©partementales de l‚ÄôIs√®re (ADI)", url:"#", note:"Registres, plans, photos" }
  ],

  contribute: {
    email:"mairie@sechilienne.fr",
    pitch:"Partagez vos souvenirs, photos, documents ‚Äî l‚Äôhistoire de S√©chilienne s‚Äô√©crit avec vous !"
  }
};

/* ========= Config de navigation (tes rubriques) ========= */
const NAV = [
  { id:"chrono", label:"Rep√®res chronologiques", desc:"Frise interactive d‚ÄôAntiquit√© √† nos jours" },
  { id:"patrimoine", label:"Patrimoine & sites", desc:"Ch√¢teaux, √©glises, hameaux, ponts, fours, lavoirs‚Ä¶" },
  { id:"personnalites", label:"Personnalit√©s & familles", desc:"Seigneurs, r√©sistants, figures locales‚Ä¶" },
  { id:"guerres", label:"S√©chilienne pendant les guerres", desc:"Monuments, t√©moignages, archives, photos" },
  { id:"vie", label:"Vie quotidienne", desc:"√âcoles, m√©tiers, agriculture, f√™tes, traditions‚Ä¶" },
  { id:"economie", label:"De l‚Äô√©conomie rurale √† l‚Äôindustrie", desc:"Artisanat, premiers sites industriels, impacts sociaux" },
  { id:"galerie", label:"Galerie", desc:"Photos, cartes postales, gravures, documents" },
  { id:"ressources", label:"Ressources", desc:"Bibliographie, liens, publications, bulletins" },
  { id:"contribuer", label:"Appel √† contributions", desc:"Partagez vos souvenirs, photos, documents" }
];

/* ========= Utils ========= */
const byOrder = (a,b)=>(a.order??999)-(b.order??999);
const go = hash => location.hash = hash;
const parseRoute = () => {
  const p = location.hash.slice(1).split('/').filter(Boolean);
  if(!p.length) return {name:"home", section:"chrono"};
  if(p[0]==="fiche" && p.length>=3) return {name:"fiche", type:p[1], slug:p.slice(2).join('/')};
  if(p[0]==="section" && p[1]) return {name:"section", section:p[1]};
  if(p[0]==="galerie") return {name:"galerie"};
  if(p[0]==="ressources") return {name:"ressources"};
  if(p[0]==="contribuer") return {name:"contribuer"};
  return {name:"home", section:"chrono"};
};
async function loadData(){
  try{
    const r = await fetch("data.json",{cache:"no-store"});
    if(!r.ok) throw 0; return await r.json();
  }catch{ return DEFAULT_DATA }
}

/* ========= Composants UI ========= */
const Card=({children,className=""})=><div className={`rounded-2xl border border-black/10 bg-white/80 backdrop-blur shadow-sm ${className}`}>{children}</div>;
const SectionTitle=({title,subtitle,action})=>(
  <div className="flex items-end justify-between gap-4">
    <div><h2 className="text-2xl md:text-3xl font-semibold">{title}</h2>
        {subtitle && <p className="text-sm text-black/60 mt-1">{subtitle}</p>}</div>
    {action}
  </div>
);

/* === Carte Patrimoine === */
function Carte({pois}){
  const ref = React.useRef(null);
  React.useEffect(()=>{
    const map = L.map(ref.current).setView([45.05,5.84],12);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{maxZoom:19,attribution:"&copy; OpenStreetMap"}).addTo(map);
    const grp={}; const ms=[];
    [...pois].sort(byOrder).forEach(p=>{
      const icon = L.divIcon({className:"",html:`<span style="display:inline-block;width:12px;height:12px;border-radius:9999px;background:#1f2937;border:2px solid #fff;box-shadow:0 0 0 2px rgba(0,0,0,.15)"></span>`});
      const m=L.marker([p.lat,p.lng],{icon}).bindPopup(`<strong>${p.name}</strong><br/><small>${p.kind||"site"}</small><br/>${p.note||""}<br/><a href="#/fiche/poi/${p.slug}">Fiche ‚Üí</a>`);
      (grp[p.kind||"site"] ||= L.layerGroup()).addLayer(m); ms.push(m);
    });
    Object.values(grp).forEach(g=>g.addTo(map));
    if(ms.length) map.fitBounds(L.featureGroup(ms).getBounds().pad(0.2));
    return ()=>map.remove();
  },[pois]);
  return <div id="map" ref={ref} className="rounded-2xl border border-black/10 overflow-hidden"></div>;
}

/* === Frise (rep√®res & filtres par √®re) === */
function Frise({events, eras, eraFilter, onEra}){
  const data = React.useMemo(()=>events.filter(e=>eraFilter==="all"||e.era===eraFilter).sort(byOrder),[events,eraFilter]);
  return (
    <Card className="p-4 md:p-6">
      <SectionTitle title="Frise chronologique" subtitle="Parcourez les grandes √©tapes"/>
      <div className="flex flex-wrap gap-2 mb-4">
        {eras.map(e=><button key={e.id} onClick={()=>onEra(e.id)} className={`px-3 py-1 rounded-full text-sm border ${eraFilter===e.id?'bg-black text-white':'bg-white'}`}>{e.label}</button>)}
      </div>
      <div className="overflow-x-auto no-scrollbar">
        <div className="flex gap-4 min-w-max pr-4">
          {data.map(e=>(
            <button key={e.id} onClick={()=>go(`#/fiche/event/${e.slug}`)} className="w-80 text-left">
              <div className="rounded-2xl border border-black/10 bg-white/80 p-4 hover:shadow">
                <div className="text-xs uppercase text-black/60">{e.year}</div>
                <div className="mt-1 text-lg font-semibold">{e.title}</div>
                <p className="text-sm text-black/70 mt-2">{e.summary}</p>
                <div className="mt-2 flex flex-wrap gap-2">{(e.tags||[]).map(t=><span key={t} className="px-2 py-0.5 text-xs rounded-full border">{t}</span>)}</div>
              </div>
            </button>
          ))}
        </div>
      </div>
    </Card>
  );
}

/* === Listes simples par rubrique === */
const ListItem=({title,subtitle,summary,onClick})=>(
  <button onClick={onClick} className="text-left w-full rounded-xl border border-black/10 bg-white/80 p-4 hover:shadow">
    <div className="text-xs uppercase text-black/60">{subtitle}</div>
    <div className="text-lg font-semibold mt-0.5">{title}</div>
    {summary && <p className="text-sm text-black/70 mt-2">{summary}</p>}
  </button>
);

/* === Fiche (sous-page) === */
function Fiche({type,slug,data}){
  let item, title, subtitle;
  if(type==="event"){ item=data.events.find(x=>x.slug===slug); title=item?.title; subtitle=item?.year; }
  if(type==="poi"){ item=data.pois.find(x=>x.slug===slug); title=item?.name; subtitle=item?.kind; }
  if(type==="family"){ item=data.families.find(x=>x.slug===slug); title=item?.name; subtitle=item?.period; }
  if(!item) return <Card className="p-6">Fiche introuvable. <a href="#/" className="underline">Retour</a></Card>;
  const html = marked.parse(item.body||"");
  return (
    <div className="space-y-4">
      <Card className="p-6">
        <div className="flex items-center justify-between">
          <div><div className="text-xs uppercase text-black/60">{subtitle||""}</div><h1 className="text-2xl md:text-3xl font-semibold">{title}</h1></div>
          <button onClick={()=>history.back()} className="px-3 py-2 rounded-lg border">‚Üê Retour</button>
        </div>
        <div className="prose mt-4" dangerouslySetInnerHTML={{__html:html}}></div>
      </Card>
    </div>
  );
}

/* === Vues par section === */
function SectionView({id, data}){
  const [era, setEra] = React.useState("all");

  if(id==="chrono"){
    const ev = data.events.filter(e=>e.section==="chrono");
    return <Frise events={ev} eras={data.eras} eraFilter={era} onEra={setEra} />;
  }

  if(id==="patrimoine"){
    const pts = data.pois.filter(p=>p.section==="patrimoine").sort(byOrder);
    return (
      <>
        <Card className="p-4 md:p-6"><SectionTitle title="Patrimoine & sites" subtitle="Cliquez un marqueur pour ouvrir la fiche"/></Card>
        <Carte pois={pts}/>
        <div className="grid md:grid-cols-2 gap-4 mt-6">
          {pts.map(p=> <ListItem key={p.slug} title={p.name} subtitle={p.kind||"site"} summary={p.note} onClick={()=>go(`#/fiche/poi/${p.slug}`)}/>)}
        </div>
      </>
    );
  }

  if(id==="personnalites"){
    const fam = data.families.filter(f=>f.section==="personnalites").sort(byOrder);
    return (
      <div className="grid md:grid-cols-3 gap-4">
        {fam.map(f=> <ListItem key={f.slug} title={f.name} subtitle={f.period} summary={f.note} onClick={()=>go(`#/fiche/family/${f.slug}`)} />)}
      </div>
    );
  }

  if(id==="guerres"){
    const ev = data.events.filter(e=>e.section==="guerres").sort(byOrder);
    return <div className="grid md:grid-cols-2 gap-4">{ev.map(e=><ListItem key={e.id} title={e.title} subtitle={e.year} summary={e.summary} onClick={()=>go(`#/fiche/event/${e.slug}`)} />)}</div>;
  }

  if(id==="vie" || id==="economie"){
    const ev = data.events.filter(e=>e.section===id).sort(byOrder);
    const art = (data.articles||[]).filter(a=>a.section===id).sort(byOrder);
    return (
      <>
        {art.length>0 && (
          <Card className="p-4 md:p-6"><SectionTitle title="Articles th√©matiques" subtitle="Synth√®ses & dossiers"/></Card>
        )}
        <div className="grid md:grid-cols-2 gap-4">
          {art.map(a=> <ListItem key={a.id} title={a.title} subtitle="Article" summary={a.summary} onClick={()=>go(`#/fiche/event/${a.slug}`)}/>)}
        </div>
        {ev.length>0 && (
          <Card className="p-4 md:p-6 mt-6"><SectionTitle title="Rep√®res associ√©s" subtitle="√âv√©nements, p√©riodes, lieux"/></Card>
        )}
        <div className="grid md:grid-cols-2 gap-4">
          {ev.map(e=> <ListItem key={e.id} title={e.title} subtitle={e.year} summary={e.summary} onClick={()=>go(`#/fiche/event/${e.slug}`)} />)}
        </div>
      </>
    );
  }

  if(id==="galerie"){
    const pics = (data.gallery||[]).sort(byOrder);
    return (
      <div className="grid sm:grid-cols-2 md:grid-cols-3 gap-4">
        {pics.map(g=>(
          <Card key={g.id} className="overflow-hidden">
            <img src={g.src} alt={g.caption||""} className="w-full h-48 object-contain bg-white"/>
            <div className="p-3">
              <div className="text-sm">{g.caption||"Sans l√©gende"}</div>
              {g.credit && <div className="text-xs text-black/60 mt-1">{g.credit}</div>}
            </div>
          </Card>
        ))}
      </div>
    );
  }

  if(id==="ressources"){
    const rs = (data.resources||[]);
    return (
      <Card className="p-4 md:p-6">
        <ul className="list-disc list-inside space-y-2">
          {rs.map(r=> <li key={r.id}><a className="underline" href={r.url} target="_blank" rel="noreferrer">{r.label}</a>{r.note? ` ‚Äî ${r.note}`:""}</li>)}
        </ul>
      </Card>
    );
  }

  if(id==="contribuer"){
    const c = data.contribute||{};
    return (
      <Card className="p-6">
        <h2 className="text-2xl font-semibold">Appel √† contributions</h2>
        <p className="text-black/70 mt-2">{c.pitch||"Partagez vos souvenirs, photos, documents."}</p>
        {c.email && <a className="inline-block mt-4 px-4 py-2 rounded-xl border bg-white hover:bg-black hover:text-white" href={`mailto:${c.email}?subject=S%C3%A9chilienne%20-%20Contribution`}>√âcrire √† la mairie</a>}
        <p className="text-xs text-black/60 mt-4">Vous pouvez aussi d√©poser temporairement vos fichiers √† l‚Äôaccueil municipal pour num√©risation.</p>
      </Card>
    );
  }

  return null;
}

/* === Admin minimal (√©v√©nements / sites / familles) ‚Äî activez avec ?admin=1 === */
function Admin({data,setData}){
  const [tab,setTab]=React.useState("events");
  const [idx,setIdx]=React.useState(null);
  const L=data[tab]; const cur=idx!=null?L[idx]:null;
  const up=(patch)=>{const c=structuredClone(data); Object.assign(c[tab][idx],patch); setData(c);};
  const add=(obj)=>{const c=structuredClone(data); c[tab].push(obj); setData(c); setIdx(c[tab].length-1);};
  const del=()=>{const c=structuredClone(data); c[tab].splice(idx,1); setData(c); setIdx(null);};
  const exportJSON=()=>{const blob=new Blob([JSON.stringify(data,null,2)],{type:"application/json"});const a=document.createElement('a');a.href=URL.createObjectURL(blob);a.download="data.json";a.click();};
  return (
    <div className="fixed inset-0 z-50 bg-black/30 backdrop-blur-sm flex">
      <div className="w-80 bg-white h-full border-r border-black/10 p-3 overflow-y-auto">
        <div className="flex gap-1 mb-2">
          {["events","pois","families"].map(t=>(
            <button key={t} onClick={()=>{setTab(t);setIdx(null);}} className={`px-3 py-2 rounded-lg border ${tab===t?'bg-black text-white':'bg-white'}`}>
              {t==="events"?"√âv√©nements":t==="pois"?"Sites":"Maisons"}
            </button>
          ))}
        </div>
        <div className="text-xs text-black/60 mb-2">S√©lectionnez un √©l√©ment</div>
        <div className="space-y-1">
          {L.map((it,i)=>(
            <button key={i} onClick={()=>setIdx(i)} className={`w-full text-left px-3 py-2 rounded-lg border ${idx===i?'bg-black text-white':'bg-white'}`}>
              <div className="text-sm font-medium truncate">{it.title||it.name}</div>
              <div className="text-xs opacity-70 truncate">{it.year||it.kind||it.period}</div>
            </button>
          ))}
        </div>
        <div className="grid grid-cols-2 gap-2 mt-3">
          {tab==="events" && <button className="px-3 py-2 rounded-lg border" onClick={()=>add({id:"e-"+Date.now(),slug:"",section:"chrono",year:"",era:"XXe",title:"",summary:"",tags:[],group:"",order:999,importance:1,body:""})}>+ √âv√©nement</button>}
          {tab==="pois" && <button className="px-3 py-2 rounded-lg border" onClick={()=>add({id:"p-"+Date.now(),slug:"",section:"patrimoine",name:"",lat:45,lng:5.8,kind:"patrimoine",note:"",order:999,body:""})}>+ Site</button>}
          {tab==="families" && <button className="px-3 py-2 rounded-lg border" onClick={()=>add({name:"",slug:"",section:"personnalites",period:"",note:"",order:999,body:""})}>+ Maison</button>}
          {idx!=null && <button className="px-3 py-2 rounded-lg border" onClick={del}>üóë Supprimer</button>}
        </div>
        <div className="mt-4"><button className="px-3 py-2 rounded-lg border w-full" onClick={exportJSON}>‚¨áÔ∏è Exporter data.json</button></div>
        <div className="text-[11px] text-black/60 mt-3">Les autres rubriques (articles, galerie, ressources) s‚Äô√©ditent en modifiant <code>data.json</code>.</div>
      </div>
      <div className="flex-1 bg-white p-4 overflow-y-auto">
        <div className="flex justify-between items-center">
          <div className="font-semibold">√âdition ‚Äî {tab}</div>
          <button className="px-3 py-2 rounded-lg border" onClick={()=>document.dispatchEvent(new CustomEvent('close-admin'))}>Fermer</button>
        </div>
        {!cur && <div className="text-sm text-black/60 mt-4">S√©lectionnez un √©l√©ment √† gauche.</div>}
        {cur && tab==="events" && (
          <div className="grid md:grid-cols-2 gap-4 mt-4">
            <label className="text-sm">Slug<input className="w-full border rounded-lg px-3 py-2" value={cur.slug||""} onChange={e=>up({slug:e.target.value})}/></label>
            <label className="text-sm">Section (chrono/guerres/economie/vie)<input className="w-full border rounded-lg px-3 py-2" value={cur.section||"chrono"} onChange={e=>up({section:e.target.value})}/></label>
            <label className="text-sm">Ann√©e/p√©riode<input className="w-full border rounded-lg px-3 py-2" value={cur.year||""} onChange={e=>up({year:e.target.value})}/></label>
            <label className="text-sm">√àre (antiquite/moyenage/modernes/r√©volution/XXe)<input className="w-full border rounded-lg px-3 py-2" value={cur.era||""} onChange={e=>up({era:e.target.value})}/></label>
            <label className="text-sm md:col-span-2">Titre<input className="w-full border rounded-lg px-3 py-2" value={cur.title||""} onChange={e=>up({title:e.target.value})}/></label>
            <label className="text-sm md:col-span-2">R√©sum√©<textarea className="w-full border rounded-lg px-3 py-2" rows="3" value={cur.summary||""} onChange={e=>up({summary:e.target.value})}></textarea></label>
            <label className="text-sm">Groupe<input className="w-full border rounded-lg px-3 py-2" value={cur.group||""} onChange={e=>up({group:e.target.value})}/></label>
            <label className="text-sm">Ordre<input type="number" className="w-full border rounded-lg px-3 py-2" value={cur.order??999} onChange={e=>up({order:parseInt(e.target.value,10)})}/></label>
            <label className="text-sm">Importance (1-3)<input type="number" min="1" max="3" className="w-full border rounded-lg px-3 py-2" value={cur.importance??1} onChange={e=>up({importance:parseInt(e.target.value,10)})}/></label>
            <label className="text-sm md:col-span-2">Corps (Markdown)<textarea className="w-full border rounded-lg px-3 py-2" rows="8" value={cur.body||""} onChange={e=>up({body:e.target.value})}></textarea></label>
          </div>
        )}
        {cur && tab==="pois" && (
          <div className="grid md:grid-cols-2 gap-4 mt-4">
            <label className="text-sm">Slug<input className="w-full border rounded-lg px-3 py-2" value={cur.slug||""} onChange={e=>up({slug:e.target.value})}/></label>
            <label className="text-sm">Section (patrimoine)<input className="w-full border rounded-lg px-3 py-2" value={cur.section||"patrimoine"} onChange={e=>up({section:e.target.value})}/></label>
            <label className="text-sm">Nom<input className="w-full border rounded-lg px-3 py-2" value={cur.name||""} onChange={e=>up({name:e.target.value})}/></label>
            <label className="text-sm">Latitude<input type="number" step="0.000001" className="w-full border rounded-lg px-3 py-2" value={cur.lat} onChange={e=>up({lat:parseFloat(e.target.value)})}/></label>
            <label className="text-sm">Longitude<input type="number" step="0.000001" className="w-full border rounded-lg px-3 py-2" value={cur.lng} onChange={e=>up({lng:parseFloat(e.target.value)})}/></label>
            <label className="text-sm">Cat√©gorie<input className="w-full border rounded-lg px-3 py-2" value={cur.kind||""} onChange={e=>up({kind:e.target.value})}/></label>
            <label className="text-sm">Ordre<input type="number" className="w-full border rounded-lg px-3 py-2" value={cur.order??999} onChange={e=>up({order:parseInt(e.target.value,10)})}/></label>
            <label className="text-sm md:col-span-2">Note<textarea className="w-full border rounded-lg px-3 py-2" rows="3" value={cur.note||""} onChange={e=>up({note:e.target.value})}></textarea></label>
            <label className="text-sm md:col-span-2">Corps (Markdown)<textarea className="w-full border rounded-lg px-3 py-2" rows="6" value={cur.body||""} onChange={e=>up({body:e.target.value})}></textarea></label>
          </div>
        )}
        {cur && tab==="families" && (
          <div className="grid md:grid-cols-2 gap-4 mt-4">
            <label className="text-sm">Slug<input className="w-full border rounded-lg px-3 py-2" value={cur.slug||""} onChange={e=>up({slug:e.target.value})}/></label>
            <label className="text-sm">Section (personnalites)<input className="w-full border rounded-lg px-3 py-2" value={cur.section||"personnalites"} onChange={e=>up({section:e.target.value})}/></label>
            <label className="text-sm">Nom<input className="w-full border rounded-lg px-3 py-2" value={cur.name||""} onChange={e=>up({name:e.target.value})}/></label>
            <label className="text-sm">P√©riode<input className="w-full border rounded-lg px-3 py-2" value={cur.period||""} onChange={e=>up({period:e.target.value})}/></label>
            <label className="text-sm">Ordre<input type="number" className="w-full border rounded-lg px-3 py-2" value={cur.order??999} onChange={e=>up({order:parseInt(e.target.value,10)})}/></label>
            <label className="text-sm md:col-span-2">Note<textarea className="w-full border rounded-lg px-3 py-2" rows="3" value={cur.note||""} onChange={e=>up({note:e.target.value})}></textarea></label>
            <label className="text-sm md:col-span-2">Corps (Markdown)<textarea className="w-full border rounded-lg px-3 py-2" rows="6" value={cur.body||""} onChange={e=>up({body:e.target.value})}></textarea></label>
          </div>
        )}
      </div>
    </div>
  );
}

/* === App & Router === */
function App(){
  const [data,setData]=React.useState(DEFAULT_DATA);
  const [route,setRoute]=React.useState(parseRoute());
  const isAdmin = new URLSearchParams(location.search).get("admin")==="1";

  React.useEffect(()=>{ loadData().then(setData); },[]);
  React.useEffect(()=>{ const on=()=>setRoute(parseRoute()); addEventListener("hashchange",on); return ()=>removeEventListener("hashchange",on); },[]);
  React.useEffect(()=>{ const close=()=>document.getElementById("admin").remove(); document.addEventListener("close-admin",close); return ()=>document.removeEventListener("close-admin",close); },[]);

  const section = route.section || "chrono";
  const navItems = NAV;

  return (
    <div>
      <header className="sticky top-0 z-30 border-b border-black/10 bg-[rgba(255,255,255,0.65)] backdrop-blur">
        <div className="mx-auto max-w-6xl px-4 py-3 flex items-center justify-between gap-3">
          <div>
            <h1 className="text-xl md:text-2xl font-bold">S√©chilienne ‚Äî Histoire & Patrimoines</h1>
            <p className="text-xs md:text-sm text-black/60">Exploration interactive du pass√© local</p>
          </div>
          <nav className="hidden md:flex items-center gap-1">
            {navItems.map(n=>(
              <button key={n.id} onClick={()=>go(n.id==="galerie"||n.id==="ressources"||n.id==="contribuer" ? `#/${n.id}` : `#/section/${n.id}`)}
                className={`px-3 py-2 rounded-xl text-sm border ${ (section===n.id || (route.name===n.id) ) ? 'bg-black text-white border-black' : 'bg-white/70 border-black/10 hover:bg-white'}`}>
                {n.label}
              </button>
            ))}
            {isAdmin && <button className="px-3 py-2 rounded-xl text-sm border" onClick={()=>document.getElementById("admin")?.classList.remove("hidden")}>‚úèÔ∏è Modifier</button>}
          </nav>
        </div>
        <div className="md:hidden px-4 pb-2 flex gap-2 overflow-x-auto no-scrollbar">
          {navItems.map(n=>(
            <button key={n.id} onClick={()=>go(n.id==="galerie"||n.id==="ressources"||n.id==="contribuer" ? `#/${n.id}` : `#/section/${n.id}`)} className="px-3 py-2 rounded-xl text-sm border bg-white/80">{n.label}</button>
          ))}
          {isAdmin && <button className="px-3 py-2 rounded-xl text-sm border" onClick={()=>document.getElementById("admin")?.classList.remove("hidden")}>‚úèÔ∏è</button>}
        </div>
      </header>

      <main className="mx-auto max-w-6xl px-4 py-6 space-y-6">
        {route.name==="fiche" ? (
          <Fiche type={route.type} slug={route.slug} data={data}/>
        ) : route.name==="galerie" ? (
          <>
            <Card className="p-4 md:p-6"><SectionTitle title="Galerie d‚Äôimages & documents" subtitle="Photos, cartes postales, gravures"/></Card>
            <SectionView id="galerie" data={data}/>
          </>
        ) : route.name==="ressources" ? (
          <>
            <Card className="p-4 md:p-6"><SectionTitle title="Ressources & approfondissements" subtitle="Bibliographie, liens, publications"/></Card>
            <SectionView id="ressources" data={data}/>
          </>
        ) : route.name==="contribuer" ? (
          <>
            <Card className="p-4 md:p-6"><SectionTitle title="Appel √† contributions" subtitle="Partagez vos souvenirs, photos, documents"/></Card>
            <SectionView id="contribuer" data={data}/>
          </>
        ) : (
          <>
            <Card className="p-4 md:p-6">
              <SectionTitle title={NAV.find(n=>n.id===section)?.label || "Section"} subtitle={NAV.find(n=>n.id===section)?.desc}/>
            </Card>
            <SectionView id={section} data={data}/>
          </>
        )}

        <Card className="p-4 md:p-6">
          <SectionTitle title="M√©thodologie & sources" subtitle="√Ä compl√©ter avant publication"/>
          <ul className="mt-3 list-disc list-inside text-sm text-black/80 space-y-1">
            <li>V√©rifier les dates & toponymes (ADI, AHPV, bibliographie locale).</li>
            <li>Illustrer (galerie) : cr√©dits, l√©gendes, provenance.</li>
            <li>Structurer les jalons par <code>group</code> & <code>order</code> ; d√©tailler via <code>body</code> (Markdown).</li>
          </ul>
        </Card>
      </main>

      <footer className="mx-auto max-w-6xl px-4 pb-10 text-xs text-black/60">¬© Commune de S√©chilienne ‚Äî Gabarit statique (React UMD + Tailwind + Leaflet). Donn√©es : <code>data.json</code>. Sous-pages par hash.</footer>

      {/* panneau admin cach√© (ouvrir via bouton ‚úèÔ∏è en haut, avec ?admin=1 dans l‚ÄôURL) */}
      {isAdmin && (
        <div id="admin" className="hidden fixed inset-0">
          <Admin data={data} setData={setData}/>
        </div>
      )}
    </div>
  );
}

ReactDOM.createRoot(document.getElementById('root')).render(<App/>);
</script>
</body>
</html>
