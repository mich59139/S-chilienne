import React, { useMemo, useState } from "react";

/**
 * Histoire vivante de S√©chilienne ‚Äî Gabarit interactif (une seule page)
 * --------------------------------------------------------------
 * ‚Ä¢ Tailwind CSS pour la mise en forme (classes utilitaires)
 * ‚Ä¢ Aucune d√©pendance externe obligatoire (pour rester portable)
 * ‚Ä¢ Sections : Carte (placeholder), Frise chronologique, G√©n√©alogies, Industrie, M√©moire 39‚Äì45
 * ‚Ä¢ Donn√©es d'exemple ‚âà √† remplacer par vos contenus sourc√©s (cf. TODO en bas)
 * ‚Ä¢ Design : cartes arrondies, ombres douces, grille a√©r√©e, petites animations CSS
 */

// === Donn√©es d'exemple (√† remplacer) ===
const ERAS = [
  { id: "all", label: "Tout" },
  { id: "antiquite", label: "Antiquit√©" },
  { id: "moyenage", label: "Moyen √Çge" },
  { id: "modernes", label: "Temps modernes" },
  { id: "xix", label: "XIXe" },
  { id: "xx", label: "XXe" },
  { id: "xxi", label: "XXIe" },
];

const EVENTS = [
  {
    id: "e-voie-romaine",
    year: "Ier‚ÄìIVe s.",
    era: "antiquite",
    title: "Voie romaine de la Romanche",
    summary:
      "Trac√© antique dans la vall√©e (Grenoble ‚áÑ Oisans), tron√ßons visibles et √† documenter. (√Ä sourcer pr√©cis√©ment pour le site)",
    tags: ["patrimoine", "arch√©o"],
  },
  {
    id: "e-alleman",
    year: "v. 1195‚Äì1248",
    era: "moyenage",
    title: "Guigues I·µâ ≥ Alleman, 1·µâ ≥ seigneur de S√©chilienne",
    summary:
      "D√©but de la lign√©e seigneuriale locale. (Dates et filiations √† v√©rifier selon vos sources)",
    tags: ["seigneurs", "g√©n√©alogie"],
  },
  {
    id: "e-transport-dauphine",
    year: "1349",
    era: "moyenage",
    title: "Transport du Dauphin√© √† la Couronne de France",
    summary:
      "Contexte territorial majeur pour la r√©gion. (Note de contexte, √† garder courte)",
    tags: ["contexte"],
  },
  {
    id: "e-maisons-seigneuriales",
    year: "XVIe‚ÄìXVIIe s.",
    era: "modernes",
    title: "All√©geances & maisons (Alleman ‚Üí Simiane ‚Üí du Mottet)",
    summary:
      "Jeux d‚Äôinfluences entre familles locales et grands voisins (dont Lesdigui√®res). (√Ä sourcer)",
    tags: ["seigneurs", "politique"],
  },
  {
    id: "e-industrie-romanche",
    year: "fin XIXe‚ÄìXXe s.",
    era: "xix",
    title: "Hydro√©lectricit√© & √©lectrom√©tallurgie de la Romanche",
    summary:
      "Barrage, usines de vall√©e, p√¥les d‚Äôemplois & modernisation. (Contexte r√©gional, focus S√©chilienne √† pr√©ciser)",
    tags: ["industrie", "√©nergie"],
  },
  {
    id: "e-silicium",
    year: "XXe‚ÄìXXIe s.",
    era: "xxi",
    title: "Usine de silicium √† S√©chilienne",
    summary:
      "Site industriel embl√©matique √† documenter (photos, dates, acteurs).",
    tags: ["industrie", "√©conomie"],
  },
  {
    id: "e-mottet-44",
    year: "21‚Äì22 ao√ªt 1944",
    era: "xx",
    title: "Combats de la Croix du Mottet",
    summary:
      "Affrontements & m√©moires locales (t√©moignages, st√®les, noms).",
    tags: ["m√©moire", "Seconde Guerre mondiale"],
  },
  {
    id: "e-chateau-1944",
    year: "1944",
    era: "xx",
    title: "Incendie du ch√¢teau de S√©chilienne",
    summary: "Destruction par les troupes allemandes (√† contextualiser et sourcer).",
    tags: ["patrimoine", "WW2"],
  },
];

const PLACES = [
  {
    id: "p-rn-roman",
    name: "Tron√ßons de voie romaine",
    kind: "patrimoine",
    blurb: "Photographier, cartographier, sourcer ‚Äî pr√©voir zooms et avant/apr√®s.",
  },
  {
    id: "p-silicium",
    name: "Usine de silicium",
    kind: "industrie",
    blurb: "Mettre en valeur l'histoire, les proc√©d√©s, les acteurs, l'emploi.",
  },
  {
    id: "p-croix-mottet",
    name: "Croix du Mottet",
    kind: "m√©moire",
    blurb: "Fiche m√©morielle (21‚Äì22 ao√ªt 1944), carte pr√©cise + liste des victimes.",
  },
  {
    id: "p-chateau",
    name: "Ch√¢teau de S√©chilienne",
    kind: "patrimoine",
    blurb: "Histoire du site, incendie de 1944, √©tat actuel, iconographie.",
  },
];

const FAMILIES = [
  { name: "Alleman", period: "XIIIe‚ÄìXIVe", note: "Premi√®re lign√©e locale document√©e (√† d√©tailler)." },
  { name: "Simiane", period: "XVIe?", note: "Transmission/alliances (v√©rifier filiations)." },
  { name: "du Mottet", period: "XVIIe‚ÄìXVIIIe", note: "Influence territoriale, toponymie (Croix du Mottet)." },
];

const INDUSTRIES = [
  { name: "Hydro√©lectricit√©", start: 1890, end: 2025, note: "Romanche : barrages, centrales, modernisations." },
  { name: "Silicium", start: 1950, end: 2025, note: "Usine √† S√©chilienne : production, innovations, emplois." },
];

const MEMOIRE44 = [
  {
    id: "m1",
    title: "21‚Äì22 ao√ªt 1944 : combats",
    text:
      "Synth√®se locale (unit√©s, parcours, chronologie), renvoyer vers dossiers AHPV & monuments.",
  },
  {
    id: "m2",
    title: "Victimes et lieux",
    text: "Liste sourc√©e, fiches biographiques, carte pr√©cise (champs, hameaux, coordonn√©es).",
  },
  {
    id: "m3",
    title: "Transmission",
    text: "Pistes p√©dagogiques, c√©r√©monies, QR codes sur site, audio-guides.",
  },
];

// Petits helpers visuels
const Pill = ({ active, children, onClick }) => (
  <button
    onClick={onClick}
    className={`px-3 py-1 rounded-full text-sm transition-all border ${
      active
        ? "bg-black/90 text-white border-black shadow"
        : "bg-white/70 backdrop-blur border-black/10 hover:bg-white"
    }`}
  >
    {children}
  </button>
);

const Card = ({ children, className = "" }) => (
  <div className={`rounded-2xl border border-black/10 bg-white/80 backdrop-blur shadow-sm ${className}`}>
    {children}
  </div>
);

const SectionTitle = ({ icon, title, subtitle }) => (
  <div className="flex items-end justify-between gap-4">
    <div>
      <h2 className="text-2xl md:text-3xl font-semibold tracking-tight flex items-center gap-3">
        <span className="inline-flex h-9 w-9 items-center justify-center rounded-xl border border-black/10 bg-white/70">{icon}</span>
        {title}
      </h2>
      {subtitle && (
        <p className="text-sm text-black/60 mt-1">{subtitle}</p>
      )}
    </div>
  </div>
);

function Frise({ events, eraFilter }) {
  const data = useMemo(
    () => events.filter((e) => eraFilter === "all" || e.era === eraFilter),
    [events, eraFilter]
  );

  return (
    <Card className="p-4 md:p-6">
      <SectionTitle
        icon={<span>üï∞Ô∏è</span>}
        title="Frise chronologique"
        subtitle="Faites glisser pour parcourir les √©poques ; chaque carte renvoie vers une fiche d√©taill√©e."
      />
      <div className="mt-4 overflow-x-auto no-scrollbar">
        <div className="flex gap-4 min-w-max pr-4">
          {data.map((e) => (
            <div key={e.id} className="w-80 shrink-0">
              <div className="h-full rounded-2xl border border-black/10 bg-gradient-to-b from-white to-white/60 p-4 hover:shadow-md transition-shadow">
                <div className="text-xs tracking-wide uppercase text-black/60">{e.year}</div>
                <div className="mt-1 text-lg font-semibold">{e.title}</div>
                <p className="mt-2 text-sm text-black/70 leading-relaxed">{e.summary}</p>
                <div className="mt-3 flex flex-wrap gap-2">
                  {e.tags.map((t) => (
                    <span key={t} className="px-2 py-0.5 text-xs rounded-full border border-black/10 bg-white/70">
                      {t}
                    </span>
                  ))}
                </div>
              </div>
            </div>
          ))}
        </div>
      </div>
    </Card>
  );
}

function Carte({ places }) {
  return (
    <Card className="p-4 md:p-6">
      <SectionTitle
        icon={<span>üó∫Ô∏è</span>}
        title="Carte parlante (placeholder)"
        subtitle="Zone de carte interactive : √† brancher sur Leaflet/MapLibre ou une image HD annot√©e."
      />

      {/* Placeholder visuel : "mini-carte" stylis√©e */}
      <div className="mt-4 grid md:grid-cols-3 gap-4">
        <div className="md:col-span-2">
          <div className="relative h-72 md:h-96 rounded-2xl border border-black/10 bg-[radial-gradient(ellipse_at_top,_#f7f4ee,_#eae6df)] overflow-hidden">
            {/* Grille et points fictifs */}
            <svg viewBox="0 0 600 400" className="absolute inset-0 w-full h-full">
              <defs>
                <pattern id="grid" width="20" height="20" patternUnits="userSpaceOnUse">
                  <path d="M 20 0 L 0 0 0 20" fill="none" stroke="rgba(0,0,0,0.06)" strokeWidth="1" />
                </pattern>
              </defs>
              <rect width="600" height="400" fill="url(#grid)" />
              {/* Cours de la Romanche (stylis√©) */}
              <path d="M 0 260 C 120 220, 240 320, 360 300 C 440 288, 520 260, 600 280" fill="none" stroke="#7bb0d8" strokeWidth="10" strokeLinecap="round" />
              {/* Points d'int√©r√™t */}
              <g>
                <Marker x={120} y={240} label="Voie romaine" />
                <Marker x={300} y={210} label="Croix du Mottet" />
                <Marker x={430} y={260} label="Usine silicium" />
                <Marker x={220} y={180} label="Ch√¢teau" />
              </g>
            </svg>
          </div>
        </div>
        <div className="space-y-3">
          {places.map((p) => (
            <div key={p.id} className="p-3 rounded-xl border border-black/10 bg-white/70">
              <div className="text-sm font-semibold">{p.name}</div>
              <div className="text-xs text-black/60 mt-0.5 uppercase tracking-wide">{p.kind}</div>
              <p className="text-sm text-black/70 mt-1">{p.blurb}</p>
            </div>
          ))}
        </div>
      </div>
    </Card>
  );
}

function Marker({ x, y, label }) {
  return (
    <g transform={`translate(${x}, ${y})`}>
      <circle r="7" fill="#111" />
      <circle r="3" fill="#fff" />
      <rect x="10" y="-10" rx="6" ry="6" width="130" height="22" fill="#ffffffcc" stroke="#0000001a" />
      <text x="18" y="6" fontSize="12" fill="#111">{label}</text>
    </g>
  );
}

function Genealogies({ families }) {
  return (
    <Card className="p-4 md:p-6">
      <SectionTitle icon={<span>üå≥</span>} title="G√©n√©alogies seigneuriales" subtitle="Arborescence simplifi√©e ‚Äî √† remplacer par votre arbre d√©taill√©." />

      <div className="mt-6 grid grid-cols-1 md:grid-cols-3 gap-4 items-start">
        {families.map((f, idx) => (
          <div key={f.name} className="relative">
            {idx < families.length - 1 && (
              <div className="hidden md:block absolute top-10 left-full w-8 h-0.5 bg-black/10" />
            )}
            <div className="p-4 rounded-2xl border border-black/10 bg-white/70">
              <div className="text-lg font-semibold">{f.name}</div>
              <div className="text-xs text-black/60 uppercase tracking-wide">{f.period}</div>
              <p className="text-sm text-black/70 mt-2">{f.note}</p>
            </div>
          </div>
        ))}
      </div>

      <p className="mt-4 text-xs text-black/60">Astuce : brancher une vraie g√©n√©alogie (GEDCOM ‚Üí JSON) pour un rendu interactif (d√©pliants, fiches, portraits).</p>
    </Card>
  );
}

function Industrie({ industries }) {
  return (
    <Card className="p-4 md:p-6">
      <SectionTitle icon={<span>‚öôÔ∏è</span>} title="Industrie & √©nergie" subtitle="Chronologie des activit√©s (barres proportionnelles)" />

      <div className="mt-6 space-y-4">
        {industries.map((i) => (
          <div key={i.name} className="p-4 rounded-xl border border-black/10 bg-white/70">
            <div className="flex items-baseline justify-between">
              <div>
                <div className="text-base font-semibold">{i.name}</div>
                <div className="text-xs text-black/60">{i.start} ‚Üí {i.end}</div>
              </div>
              <div className="text-sm text-black/70">{i.note}</div>
            </div>
            {/* Mini-barre temporelle */}
            <div className="mt-3 h-3 rounded-full bg-black/5">
              <div
                className="h-3 rounded-full bg-black/70"
                style={{ width: `${Math.min(100, Math.max(0, (i.end - i.start) / (2025 - 1800) * 100))}%` }}
                title={`${i.start}‚Äì${i.end}`}
              />
            </div>
          </div>
        ))}
      </div>

      <div className="mt-4 text-xs text-black/60">
        Id√©e : relier chaque activit√© √† une fiche (photos chantier, ouvriers, coupures de presse, cartes postales, plans) + carte des sites.
      </div>
    </Card>
  );
}

function Memoire({ items }) {
  return (
    <Card className="p-4 md:p-6">
      <SectionTitle icon={<span>üïØÔ∏è</span>} title="M√©moire 39‚Äì45" subtitle="Dossier local ‚Äî Croix du Mottet, lieux, victimes, transmission" />
      <div className="mt-4 grid md:grid-cols-3 gap-4">
        {items.map((m) => (
          <div key={m.id} className="p-4 rounded-2xl border border-black/10 bg-white/70">
            <div className="text-base font-semibold">{m.title}</div>
            <p className="text-sm text-black/70 mt-2">{m.text}</p>
          </div>
        ))}
      </div>
      <div className="mt-4 text-xs text-black/60">Pr√©voir : frise sp√©cifique ao√ªt 1944 + carte pr√©cise des lieux, fiches nominatives, lectures publiques, QR sur site.</div>
    </Card>
  );
}

// Composant principal
export default function SechilienneHistoire() {
  const [tab, setTab] = useState("carte");
  const [era, setEra] = useState("all");

  return (
    <div className="min-h-screen bg-[radial-gradient(ellipse_at_top,_#f6f2ea,_#ece7df)] text-neutral-900">
      {/* En-t√™te */}
      <header className="sticky top-0 z-30 backdrop-blur bg-[rgba(255,255,255,0.65)] border-b border-black/10">
        <div className="mx-auto max-w-6xl px-4 py-3 flex items-center justify-between gap-4">
          <div>
            <h1 className="text-xl md:text-2xl font-bold tracking-tight">S√©chilienne ‚Äî Histoire vivante</h1>
            <p className="text-xs md:text-sm text-black/60">Un gabarit interactif pour le site de la commune ‚Ä¢ cartes ‚Ä¢ frises ‚Ä¢ g√©n√©alogies ‚Ä¢ m√©moire</p>
          </div>
          <nav className="flex items-center gap-1">
            {[
              { id: "carte", label: "Carte" },
              { id: "frise", label: "Frise" },
              { id: "genea", label: "G√©n√©alogies" },
              { id: "industrie", label: "Industrie" },
              { id: "memoire", label: "M√©moire 39‚Äì45" },
            ].map((t) => (
              <button
                key={t.id}
                className={`px-3 py-2 rounded-xl text-sm border transition ${
                  tab === t.id
                    ? "bg-black text-white border-black shadow"
                    : "bg-white/70 border-black/10 hover:bg-white"
                }`}
                onClick={() => setTab(t.id)}
              >
                {t.label}
              </button>
            ))}
          </nav>
        </div>
      </header>

      {/* Barre filtres √©poques */}
      <div className="mx-auto max-w-6xl px-4 mt-4">
        <Card className="p-3">
          <div className="flex flex-wrap items-center gap-2">
            <span className="text-sm text-black/60 mr-1">√âpoque :</span>
            {ERAS.map((e) => (
              <Pill key={e.id} active={era === e.id} onClick={() => setEra(e.id)}>
                {e.label}
              </Pill>
            ))}
          </div>
        </Card>
      </div>

      {/* Contenus */}
      <main className="mx-auto max-w-6xl px-4 py-6 space-y-6">
        {tab === "carte" && <Carte places={PLACES} />}
        {tab === "frise" && <Frise events={EVENTS} eraFilter={era} />}
        {tab === "genea" && <Genealogies families={FAMILIES} />}
        {tab === "industrie" && <Industrie industries={INDUSTRIES} />}
        {tab === "memoire" && <Memoire items={MEMOIRE44} />}

        {/* Encadr√© M√©thodo / Sources */}
        <Card className="p-4 md:p-6">
          <SectionTitle icon={<span>üß≠</span>} title="M√©thodologie & sources" subtitle="Pistes pour ancrer l'histoire locale dans le site municipal" />
          <ul className="mt-4 grid md:grid-cols-3 gap-3 text-sm text-black/80 list-disc list-inside">
            <li>Chaque carte ‚á¢ une fiche d√©taill√©e (texte court, galerie, carte, sources, liens AHPV).</li>
            <li>Frise ‚á¢ albums th√©matiques (voies, seigneurs, industrie, 39‚Äì45).</li>
            <li>G√©n√©alogies ‚á¢ arbre navigable (GEDCOM ‚Üí JSON) + portraits.</li>
            <li>Industrie ‚á¢ chronologies + cartes des sites (barrages, usines, ateliers).
            </li>
            <li>M√©moire 39‚Äì45 ‚á¢ topographie pr√©cise, listes sourc√©es, QR sur monuments.</li>
            <li>Accessibilit√© ‚á¢ textes clairs, contrastes, l√©gendes, alternatives visuelles.</li>
          </ul>
          <div className="mt-4 text-xs text-black/60">
            Remarque : les √©tiquettes ¬´ √† sourcer ¬ª indiquent des zones √† v√©rifier/compl√©ter (dates, noms, coordonn√©es). Remplacez les donn√©es d'exemple par vos contenus valid√©s.
          </div>
        </Card>

        {/* TODO rapide */}
        <Card className="p-4 md:p-6">
          <SectionTitle icon={<span>üóíÔ∏è</span>} title="√Ä faire (remplacement rapide des contenus)" />
          <ol className="mt-4 space-y-2 text-sm text-black/80 list-decimal pl-5">
            <li>Remplacer <code>EVENTS</code> par votre frise sourc√©e (titres courts, 50‚Äì120 caract√®res d'intro).</li>
            <li>Remplacer <code>PLACES</code> par vos points (puis brancher une vraie carte si souhait√©).</li>
            <li>Remplacer <code>FAMILIES</code> par votre arbre (Alleman ‚Üí Simiane ‚Üí du Mottet, etc.).</li>
            <li>Remplacer <code>INDUSTRIES</code> par vos activit√©s (dates pr√©cises, visuels).</li>
            <li>Compl√©ter <code>MEMOIRE44</code> avec les fiches noms/lieux et renvois vers vos articles.</li>
          </ol>
        </Card>
      </main>

      <footer className="mx-auto max-w-6xl px-4 pb-10 text-xs text-black/50">
        Gabarit interactif ¬© 2025 ‚Äî pour la commune de S√©chilienne / Amis de l‚ÄôHistoire du Pays Vizillois ‚Äî Design neutre, pr√™t √† habiller selon la charte.
      </footer>
    </div>
  );
}
